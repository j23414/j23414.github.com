---
layout: post
title: "RISmed: auto fetching PubMed Content"
description: ""
category: 
tags: []
---
{% include JB/setup %}

**The What**: 

RISmed is an R package for fetching data from PubMed.

```
  Stephanie Kovalchik (2016). RISmed: Download Content from NCBI Databases. R package version 2.1.6.
  https://CRAN.R-project.org/package=RISmed
```

**The So-What**:

Scripting methods for fetching pubmed data can help a researcher quickly screen and identify important publications to read, resulting in faster publication cycles, and less wasted time.

**The Now-What**:

A very basic tutorial of RISmed is included below:

Install and load the RISmed package.

```
install.packages("RISmed");
library(RISmed);
```

Then you can iterate through a list of keywords saving information on the papers and the coauthor network.

```
query_term <- "alzheimer"
start <- 1996
end <- 2016
res <- EUtilsSummary(query_term, type='esearch', db="pubmed", datetype='pdat',
                     mindate=start, maxdate=end, retmax=10000)
QueryCount(res) # get number of results

```

However to turn into a more human readable data.table, although this takes some time (minutes).

```
big <- EUtilsGet(res)
slotNames(big) # lists all possible fetchable annotation.
 [1] "Query"                "PMID"                 "YearReceived"        
 [4] "MonthReceived"        "DayReceived"          "HourReceived"        
 [7] "MinuteReceived"       "YearAccepted"         "MonthAccepted"
 ... many more results      

```

Pull out interesting items into a dataframe.

```
data <- data.frame(pmid=PMID(big), year=YearPubmed(big), title=ArticleTitle(big),
                  journal=Title(big), affiliation=Affiliation(big), country=Country(big))

# Export to tsv, save for later
write.table(data, file=paste(query_term,"-papers.tsv", sep=""), sep="\t",
              row.names=FALSE, col.names=TRUE, quote=FALSE)
```
The resulting table is similar to the following:

|pmid|year|title|journal|affiliation|country|
|:--:|:--:|:---:|:-----:|:---------:|:-----:|
|28003598 | 2016 | article title | journal title | research lab | Japan |
|28003573 | 2015 | article title | journal title | research lab | United States|

More complex items like authors per paper can be fetched in a loop. 

```
coauthors <- data.frame(Author(pmids)[1])
names(coauthors) <- c("LastName", "ForeName", "Initials", "order")
coauthors$author <- paste(coauthors$ForeName, "_", coauthors$LastName, sep="")
coauthors$author <- str_replace_all(coauthors$author, " ", "_")
coauthors$pmid <- PMID(pmids)[1]
coa <- data.frame(pmid=coauthors$pmid, author=coauthors$author, order=coauthors$order)

ll <- length(PMID(pmids))
for(j in 2:ll){
  coauthors <- data.frame(Author(pmids)[j])
  names(coauthors) <- c("LastName","ForeName","Initials","order")
  coauthors$author <- str_replace_all(paste(coauthors$ForeName,"_",coauthors$LastName,
                                      sep=""), " ","_")
  coauthors$pmid=PMID(pmids)[j]
  coa<-rbind(coa,data.frame(pmid=coauthors$pmid,author=coauthors$author,
               order=coauthors$order))
}
# export as tsv file for later
write.table(coa,file=paste(query_term,"-authors.tsv",sep=""),sep="\t",row.names=FALSE,
            col.names=TRUE,quote=FALSE)
```

| pmid | author | order |
|:----:|:------:|:-----:|
| 28003598 | Jia-Lu_Yu | 1 |
| 28003598 | Qi-Fang_Song | 2 |
| 28003598 | Zhi-Wei_Xie | 3 |
|28000890 | Wenpeng_Zhang | 1 |
|28000890 | Shiliang_Han | 2 |
|28000890 | Kang_Sun | 3 |

The total pipeline can be looped over multiple query terms.

```
terms <- c("alzheimer","parkinson")
for(i in 1:length(terms)){
  query_term <- terms[i]
  start <- 1996
  end <- 2016
  res <- EUtilsSummary(query_term,type='esearch',db='pubmed',datetype='pdat',
                       mindate=start,maxdate=end,retmax=10000)
  
  big <- EUtilsGet(res) # takes time
  
  # slotNames(big) # list all names of paper annotations
  data <- data.frame(pmid=PMID(big),year=YearPubmed(big),title=ArticleTitle(big),
                     journal=Title(big),affiliation=Affiliation(big),country=Country(big))
  write.table(data,file=paste(query_term,"-papers.tsv",sep=""),sep="\t",
              row.names=FALSE,col.names=TRUE,quote=FALSE)
  
  coauthors <- data.frame(Author(pmids)[1])
  names(coauthors)<-c("LastName","ForeName","Initials","order")
  coauthors$author<-str_replace_all(paste(coauthors$ForeName,"_",coauthors$LastName,
                                    sep=""), " ","_")
  coauthors$pmid=PMID(pmids)[1]
  coa <- data.frame(pmid=coauthors$pmid,author=coauthors$author,order=coauthors$order)

  ll <- length(PMID(pmids))
  for(j in 2:ll){
    coauthors <- data.frame(Author(pmids)[j])
    names(coauthors)<-c("LastName","ForeName","Initials","order")
    coauthors$author<-str_replace_all(paste(coauthors$ForeName,"_",coauthors$LastName,
                                      sep=""), " ","_")
    coauthors$pmid=PMID(pmids)[j]
    coa<-rbind(coa,data.frame(pmid=coauthors$pmid,author=coauthors$author,
               order=coauthors$order))
  }
  write.table(coa,file=paste(query_term,"-authors.tsv",sep=""),sep="\t",row.names=FALSE,
              col.names=TRUE,quote=FALSE)
}
```

