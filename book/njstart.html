<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Create a graph | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    
    <link rel="prev" href="./neo4j.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="2.1" data-basepath="." data-revision="Tue Feb 16 2016 14:48:19 GMT-0600 (CST)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="tinkerpop3.html">
            
                
                    <a href="./tinkerpop3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        TinkerPop3
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="tpstart.html">
            
                
                    <a href="./tpstart.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Create a graph
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="neo4j.html">
            
                
                    <a href="./neo4j.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Neo4j
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1" data-path="njstart.html">
            
                
                    <a href="./njstart.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Create a graph
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="create-a-graph">Create a graph</h1>
<pre><code>CREATE (ee:Person {name:&quot;Emil&quot;,from:&quot;Sweden&quot;,klout:99})
Added 1 label, created 1 node, set 3 properties, statement executed in 374 ms.
</code></pre><ul>
<li>CREATE clause to create data</li>
<li>() parenthesis to indicate a node</li>
<li>ee:Person a variable &apos;ee&apos; and label &quot;Person&apos; for the new node</li>
<li>{} brackets to add properties to the node</li>
</ul>
<p>GEL comparison</p>
<pre><code>node(string name, string from, int klout, string label) nt;
link[] lt;
graph(nt,lt) g={(&quot;Emil&quot;,&quot;Sweden&quot;,99,&quot;Person&quot;)};
</code></pre><ul>
<li>Create a node with name,from,klout, and label attributes</li>
<li>No link information yet</li>
<li>{} defines a graph object</li>
<li>() parenthesis to define a  node</li>
<li>id and node attributes must be listed in order.</li>
</ul>
<pre><code>MATCH(ee:Person) WHERE ee.name=&quot;Emil&quot; RETURN ee;
</code></pre><ul>
<li>MATCH clause to specify a pattern of nodes and relationships</li>
<li>(ee:Person) a single node pattern with label &apos;Person&apos; which will assign matches to the variable &apos;ee&apos;</li>
<li>WHERE clause to constrain the results</li>
<li>ee.name=&quot;Emil&quot; compares name property to the value &quot;Emil&quot;</li>
<li>RETURN clause used to request particular results</li>
</ul>
<pre><code>auto ee = select node from g where name==&quot;Emil&quot; &amp;&amp; label==&quot;Person&quot;;
auto ee = g.node.&quot;Emil&quot;;  # references the particular node by id
</code></pre><ul>
<li>store node in subgraph ee. if not found ee will be empty.</li>
<li>select clause means you are fetching a subgraph that matches a condition</li>
<li>name==&quot;Emil&quot;</li>
</ul>
<pre><code>MATCH (ee:Person) WHERE ee.name = &quot;Emil&quot; CREATE (js:Person {name:&quot;Johan&quot;,from:&quot;Sweden&quot;,learn:&quot;surfing&quot;}),(ir:Person {name:&quot;Ian&quot;,from:&quot;England&quot;,title:&quot;author&quot;}),(rvb:Person{name:&quot;Rik&quot;,from:&quot;Belgium&quot;,pet:&quot;Orval&quot;}),(ally:Person{name:&quot;Allison&quot;,from:&quot;California&quot;,hobby:&quot;surfing&quot;}),(ee)-[:KNOWS {since:2001}]-&gt;(js),(ee)-[:KNOWS{rating:5}]-&gt;(ir),(js)-[:KNOWS]-&gt;(ir),(js)-[:KNOWS]-&gt;(rvb),(ir-[:KNOWS]-&gt;(js),(ir)-[:KNOWS]-&gt;(ally),(rvb)-[:KNOWS]-&gt;(ally)
</code></pre><pre><code>node(string id, string type, string name, string from, int klout, string learn, string title, string pet, string hobby) nt;
link&lt;string type=&quot;KNOWS&quot;, string since, int rating&gt; lt;
graph(nt,lt) g = {(&quot;ee&quot;,&quot;Person&quot;,&quot;Emil&quot;,&quot;Sweden&quot;,99)[&quot;KNOWS&quot;,&quot;2001&quot;&gt;(&quot;js&quot;,&quot;Person&quot;,&quot;Johan&quot;,&quot;Sweden&quot;,0,&quot;surfing&quot;)[&quot;KNOWS&quot;&gt;(&quot;ir&quot;,&quot;Person&quot;,&quot;Ian&quot;,&quot;England&quot;,0,&quot;&quot;,&quot;author&quot;)[&gt;js,ir[&gt;(&quot;ally&quot;,&quot;Person&quot;,&quot;Allison&quot;,&quot;California&quot;,0,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;surfing&quot;)};

graph(nt,lt) g = {(&quot;ee&quot;,&quot;Person&quot;,&quot;Emil&quot;,&quot;Sweden&quot;,99),
                  (&quot;js&quot;,&quot;Person&quot;,&quot;Johan&quot;,&quot;Sweden&quot;,0,&quot;surfing&quot;),
                  (&quot;ir&quot;,&quot;Person&quot;,&quot;Ian&quot;,&quot;England&quot;,0,&quot;&quot;,&quot;author&quot;),
                  (&quot;rvb&quot;,&quot;Person&quot;,&quot;Rik&quot;,&quot;Belgium&quot;,0,&quot;&quot;,&quot;&quot;,&quot;Orval&quot;),
                  (&quot;ally&quot;,&quot;Person&quot;,&quot;Allison&quot;,&quot;California&quot;,0,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;surfing&quot;),
          ee[&quot;KNOWS&quot;,&quot;2001&quot;&gt;js,ee[&quot;KNOWS&quot;,&quot;&quot;,5&gt;ir,
          js[&quot;KNOWS&quot;&gt;ir,js[&gt;rvb,
          ir[&gt;js,ir[&gt;ally,
          rvb[&gt;ally
                 };
</code></pre><p>There are other ways to code the graph information</p>
<p>Pattern matching</p>
<pre><code>MATCH (ee:Person)-[:KNOWS]-(friends) where ee.name=&quot;Emil&quot; RETURN ee,friends
</code></pre><ul>
<li>MATCH clause to describe the pattern from known Nodes to found Nodes</li>
<li>(ee) starts the patern with a Person (qualified by WHERE)</li>
<li>-[:KNOWS]- matches &quot;KNOWS&quot; relationship (in either direction)</li>
<li>(friends) will be bound to Emil&apos;s friends</li>
</ul>
<pre><code>auto friends=select link from g where (in.name==&quot;Emil&quot; ||out.name==&quot;Emil&quot;)&amp;&amp; type=&quot;KNOWS&quot;; # only links to emil
friends+=g; # fetch the links among friends
</code></pre><p>Recommend using patterns</p>
<pre><code>MATCH (js:Person)-[:KNOWS]-()-[:KNOWS]-(surfer) WHERE js.name=&quot;Johan&quot; AND surfer.hobby=&quot;surfing&quot; RETURN DISTINCT surfer
</code></pre><pre><code>foreach node in g where hobby==&quot;surfer&quot; set _r=1;
node(g:node,int step) new_n;
link&lt;g:link, int step&gt; new_l;

graph(new_n, new_l) js = g;
foreach node in js set step=0;
foreach link in js set step=0;
js.node.&quot;js&quot;.step=1;

# run this twice
foreach link in js where in.step&gt;0 &amp;&amp; out.step==0 set out.step=in.step+1,in._text=in.step,out._text=out.step;
foreach link in js where in.step==0 &amp;&amp; out.step&gt;0 set in.step=out.step+1,in._text=in.step,out._text=out.step;

auto query=select node from js where step==3 &amp;&amp;      hobby==&quot;surfing&quot;;
foreach node in query set _text=name;
</code></pre><ul>
<li>maybe we need a feature for connected components and certain steps away from a node...</li>
</ul>
<p>Analyze</p>
<pre><code>PROFILE MATCH (js:Person)-[:KNOWS]-()-[:KNOWS]-(surfer) WHERE js.name=&quot;Johan&quot; AND surfer.hobby=&quot;surfing&quot; RETURN DISTINCT surfer
Cypher version: CYPHER 2.3, planner: COST. 29 total db hits in 32 ms.
</code></pre><pre><code>There is no profile function in gel. need this!!!
</code></pre><p>Load from a CSV!!!</p>
<pre><code>LOAD CSV WITH HEADERS FROM &quot;http://data.neo4j.com/northwind/products.csv&quot;
AS row
CREATE (n:Product)
SET n = row,
  n.unitPrice=toFloat(row.unitPrice),
  n.unitsInStock=toInt(row.unitsInStock),n.unitsOnOrder=toInt(row.unitsOnOrder),
  n.reorderLevel=toInt(row.reorderLevel),n.discontinued=row.discontinued&lt;&gt;&quot;0&quot;)
</code></pre><pre><code>LOAD CSV WITH HEADERS from &quot;http://data.neo4j.com/northwind/categories.csv&quot; AS row
CREATE(n:Category)
SET n=row
</code></pre><pre><code>LOAD CSV WITH HEADERS FROM &quot;http://data.neo4j.com/northwind/suppliers.csv&quot;
  AS row
CREATE (n:Supplier)
SET n=row
</code></pre><p>Create indexes(??)</p>
<pre><code>CREATE INDEX ON :Product(productID)
CREATE INDEX ON :Category(categoryID)
CREATE INDEX ON :Supplier(supplierID)
</code></pre><p>Create edges</p>
<pre><code>MATCH (p:Product),(c:Category)
WHERE p.categoryID = c.categoryID
CREATE (p)-[:PART_OF]-&gt;(c)
</code></pre><p>GEL</p>
<pre><code>node(p:node,c:node) nt;
link&lt;string type&gt;lt;

graph(nt,lt) combined = p*c;
combined=select link from combined where in.supplierID==out.supplierID;
foreach link in combined set type=&quot;PART_OF&quot;;  # actually match function might be better, variable length?
</code></pre><pre><code>MATCH (p:Product),(s:Supplier)
WHERE p.supplierID=s.supplierID
CREATE (s)-[:SUPPLIES]-&gt;(p)
</code></pre><p><a href="http://neo4j.com/developer/guide-importing-data-and-etl/" target="_blank">http://neo4j.com/developer/guide-importing-data-and-etl/</a></p>
<p>List the product categories provided by each supplier</p>
<pre><code>MATCH (s:Supplier)--&gt;(:Product)--&gt;(c:Category)
RETURN s.companyName as Company, collect(distinct c.cateogryName) as Categories
</code></pre><p>Find the produce suppliers</p>
<pre><code>MATCH(c:Category {CategoryName:&quot;Produce&quot;})&lt;--(:Product)&lt;--(s:Supplier)
RETURN DISTINCT s.companyName as ProduceSuppliers
</code></pre><p>Northwind customers place orders which may detail multiple products</p>
<pre><code>LOAD CSV WITH HEADERS FROM &quot;http://data.neo4j.com/northwind/customer.csv&quot;
  AS row
CREATE (n:Customer)
SET n=row

LOAD CSV WITH HEADERS FROM &quot;http://data.neo4j.com/northwind/orders.csv&quot;
  AS row
CREATE (n:Order)
SET n=row

CREATE INDEX ON :Customer(customerID)
CREATE INDEX ON :Order(orderID)
</code></pre><p>Create data relationships</p>
<pre><code>MATCH (c:Customer),(o:Order)
WHERE c.customerID=o.customerID
CREATE (c)-[:PURCHASED]-&gt;(o)
</code></pre><pre><code>LOAD CSV WITH HEADERS FROM &quot;http://data.neo4j.com/northwind/order-details.csv&quot;
  AS row
MATCH (p:Product), (o:Order)
WHERE p.ProductID = row.productID AND o.orderID = row.orderID
CREATE (o)-[details:ORDERS]-&gt;(p)
SET details=row
  details.quantity=toInt(row.quantity)
</code></pre><p>Query using patterns</p>
<pre><code>MATCH (cust:Customer)-[:PURCHASED]-&gt;(:Order)-[o:ORDERS]-&gt;(p:Product),(p)-[:PART_OF]-&gt;(c:Category {categoryName:&quot;Produce&quot;})
RETURN DISTINCT cust.contactName as CustomerName, SUM(o.quantity) AS Total ProductsPurchased
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./neo4j.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Neo4j"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
